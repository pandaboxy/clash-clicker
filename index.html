<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Clash Clicker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&display=swap');

        :root {
            --accent: #f7b42c;
            --text: #ffffff;
            --btn-blue: #3d7abd;
            --energy-color: #2ecc71;
            --energy-bg: #1e3d59;
            --tab-active: #4a6c8f;
        }

        body {
            margin: 0;
            padding: 0;
            /* –§–æ–Ω - –ò–°–ü–†–ê–í–õ–ï–ù –ü–£–¢–¨ */
            background: url('clash-clicker/public/a2fb230ac13e58c9232bc22892220593.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Lilita One', cursive;
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Header & Score (–°—Ç–∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) --- */
        .header {
            margin-top: 20px;
            text-align: center;
            z-index: 10;
            width: 90%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .rebirth-status {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid #000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .score-box {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 30px;
            border-radius: 20px;
            border: 3px solid #000;
            display: inline-block;
            box-shadow: 0 4px 0 #000;
            margin: 0 auto;
        }
        
        .score-box h1 { margin: 0; font-size: 32px; color: var(--accent); text-shadow: 2px 2px 0 #000; }
        .score-box span { font-size: 14px; color: #ccc; }
        
        #toggle-sound {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #000;
            color: var(--text);
            border-radius: 50%;
            width: 50px; height: 50px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 3px 0 #000;
            font-family: 'Lilita One', cursive;
            position: absolute;
            right: 0;
            top: 0;
        }
        #toggle-sound:active { transform: translateY(2px); box-shadow: 0 1px 0 #000; }
        
        /* --- Energy Bar (–°—Ç–∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) --- */
        .energy-display { width: 90%; max-width: 400px; margin: 15px auto 0; text-align: center; font-size: 16px; text-shadow: 1px 1px 0 #000; }
        #energy-bar { width: 100%; height: 20px; border-radius: 10px; border: 2px solid #000; background-color: var(--energy-bg); box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); }
        #energy-bar::-webkit-progress-bar { background-color: var(--energy-bg); border-radius: 10px; }
        #energy-bar::-webkit-progress-value { background-color: var(--energy-color); border-radius: 10px; transition: width 0.1s linear; }
        #energy-bar::-moz-progress-bar { background-color: var(--energy-color); border-radius: 10px; }

        /* --- Game Area (–°—Ç–∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) --- */
        .game-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; width: 100%; }
        .click-target { width: 250px; height: 250px; object-fit: contain; transition: transform 0.1s ease; cursor: pointer; filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2)); }
        .click-target:active { transform: scale(0.95); }
        .click-target.disabled { filter: grayscale(80%) opacity(50%); cursor: default; }
        .floating-text { position: absolute; font-size: 28px; font-weight: bold; color: var(--accent); pointer-events: none; animation: floatUp 0.8s ease-out forwards; text-shadow: 2px 2px 0 #000; z-index: 100; }
        .floating-text.error { color: #e74c3c; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-120px) scale(1.5); } }
        .info-panel { margin-top: 20px; font-size: 18px; text-shadow: 1px 1px 0 #000; }

        /* --- Shop Modal & Tabs (–°—Ç–∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) --- */
        .menu-bar { width: 100%; padding: 20px; display: flex; justify-content: center; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); z-index: 10; }
        .shop-btn { background: var(--btn-blue); color: white; border: 3px solid #000; border-radius: 12px; padding: 15px 40px; font-family: 'Lilita One', cursive; font-size: 22px; box-shadow: 0 6px 0 #1a4f8a, 0 10px 10px rgba(0,0,0,0.5); cursor: pointer; transition: transform 0.1s; }
        .shop-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #1a4f8a, 0 4px 4px rgba(0,0,0,0.5); }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        .shop-modal { position: fixed; bottom: 0; left: 0; width: 100%; height: 75vh; background: #223346; border-top: 4px solid #000; border-radius: 20px 20px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 101; display: flex; flex-direction: column; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); }
        .shop-modal.open { transform: translateY(0); }
        .shop-header { padding: 15px; text-align: center; background: #1a2836; border-radius: 16px 16px 0 0; border-bottom: 3px solid #000; display: flex; justify-content: space-between; align-items: center; width: auto; }
        
        .tabs { display: flex; flex-grow: 1; justify-content: flex-start; margin-right: 10px; }
        .tab-btn { background: #325075; color: #ccc; border: none; border-radius: 8px 8px 0 0; padding: 10px 15px; font-size: 16px; cursor: pointer; font-family: 'Lilita One', cursive; transition: background 0.1s; margin-right: 5px; border-bottom: 3px solid transparent; }
        .tab-btn.active { background: var(--tab-active); color: var(--accent); border-bottom: 3px solid var(--accent); }

        .close-btn { background: #e74c3c; border: 2px solid #000; color: white; border-radius: 8px; width: 35px; height: 35px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .shop-content { padding: 20px; overflow-y: auto; flex: 1; }
        .tab-content { display: none; }
        #upgrades-content { display: grid; }
        .section-title { font-size: 22px; margin-bottom: 15px; margin-top: 10px; color: #ddd; border-bottom: 2px solid #444; padding-bottom: 5px; }
        .items-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .shop-item { background: #325075; border: 3px solid #000; border-radius: 15px; padding: 10px; display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; box-shadow: 0 4px 0 rgba(0,0,0,0.3); }
        .shop-item img { width: 80px; height: 80px; object-fit: contain; margin-bottom: 10px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .shop-item h3 { font-size: 16px; margin: 5px 0; line-height: 1.2; }
        .shop-item p { font-size: 14px; margin: 5px 0; color: #ccc; }
        .shop-item button { background: var(--accent); border: 2px solid #000; border-radius: 8px; padding: 8px 10px; font-weight: bold; font-family: 'Lilita One', cursive; font-size: 16px; cursor: pointer; width: 100%; margin-top: auto; color: #000; box-shadow: 0 3px 0 #c28b1e; }
        .shop-item button:active { transform: translateY(3px); box-shadow: none; }
        .shop-item button:disabled { background: #555; color: #888; cursor: not-allowed; box-shadow: none; border-color: #444; }
        .shop-item.owned { border-color: #2ecc71; }
        .owned-badge { position: absolute; top: -5px; right: -5px; background: #2ecc71; color: white; padding: 2px 6px; border-radius: 50%; border: 2px solid #000; font-size: 14px; display: none; }
        .shop-item.owned .owned-badge { display: block; }
        
        /* --- Offline Earnings Modal (–°—Ç–∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) --- */
        .offline-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a2836; border: 4px solid var(--accent); border-radius: 15px; padding: 30px; text-align: center; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 102; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .offline-overlay.open { opacity: 1; pointer-events: auto; }
        .offline-modal.open { opacity: 1; pointer-events: auto; }
        .offline-modal h2 { color: var(--accent); margin-top: 0; font-size: 28px; }
        .offline-modal p { font-size: 18px; margin: 15px 0; }
        .offline-modal .earnings { font-size: 36px; color: var(--energy-color); margin-bottom: 20px; text-shadow: 2px 2px 0 #000; }
        .offline-modal button { background: var(--btn-blue); color: white; border: 3px solid #000; border-radius: 10px; padding: 10px 30px; font-size: 20px; box-shadow: 0 4px 0 #1a4f8a; cursor: pointer; font-family: 'Lilita One', cursive; }

    </style>
</head>
<body>

    <div class="header">
        <div class="rebirth-status" id="rebirth-status-display" style="display: none;"></div>
        
        <div class="score-box">
            <h1 id="score">0</h1>
            <span>–ú–æ–Ω–µ—Ç</span>
        </div>
        <button id="toggle-sound" onclick="toggleSound()">üîä</button>
    </div>
    
    <div class="energy-display">
        <span id="energy-text">1000 / 1000</span>
        <progress id="energy-bar" value="1000" max="1000"></progress>
    </div>

    <div class="game-area">
        <img src="/public/favpng_1a768754af869f646270eaa414faf20b.jpg" 
             onerror="this.src='https://raw.githubusercontent.com/smlbiobot/cr-assets-png/master/assets/sc/ui/chest_super_magical.png'" 
             alt="Main Skin" 
             class="click-target" 
             id="mainSkin">
             
        <div class="info-panel">
            –°–∏–ª–∞ –∫–ª–∏–∫–∞: <span id="tap-power" style="color: var(--accent);">1</span>
        </div>
    </div>

    <div class="menu-bar">
        <button class="shop-btn" onclick="toggleShop()">üõí –ú–ê–ì–ê–ó–ò–ù</button>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="toggleShop()"></div>
    <div class="shop-modal" id="shopModal">
        <div class="shop-header">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('upgrades')">‚ö° –ü—Ä–æ–∫–∞—á–∫–∞</button>
                <button class="tab-btn" onclick="showTab('skins')">üé≠ –°–∫–∏–Ω—ã</button>
                <button class="tab-btn" onclick="showTab('prizes')">üéÅ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</button>
            </div>
            <button class="close-btn" onclick="toggleShop()">‚úï</button>
        </div>
        
        <div class="shop-content">
            <div id="upgrades-content" class="tab-content">
                <div class="section-title">‚ö° –ü—Ä–æ–∫–∞—á–∫–∞</div>
                <div class="items-grid">
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Click">
                        <h3>–ú–æ—â–Ω—ã–π —É–¥–∞—Ä</h3>
                        <p>+1 –∫ –∫–ª–∏–∫—É</p>
                        <button id="btn-click" onclick="buyUpgrade('click')">50 üí∞</button>
                    </div>
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3653/3653147.png" alt="Auto">
                        <h3>–ì–æ–±–ª–∏–Ω-–≤–æ—Ä</h3>
                        <p>+1 –º–æ–Ω–µ—Ç–∞/—Å–µ–∫</p>
                        <button id="btn-auto" onclick="buyUpgrade('auto')">200 üí∞</button>
                    </div>
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3067/3067160.png" alt="Energy Limit">
                        <h3>–õ–∏–º–∏—Ç –±–∞–Ω–æ–∫</h3>
                        <p>+500 –∫ –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏–∏</p>
                        <button id="btn-energy-limit" onclick="buyUpgrade('energy_limit')">500 üí∞</button>
                    </div>
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/6073/6073873.png" alt="Recovery Rate">
                        <h3>–ú–æ–ª–Ω–∏—è</h3>
                        <p>+1 –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–µ–≥–µ–Ω–∞</p>
                        <button id="btn-recovery" onclick="buyUpgrade('recovery')">750 üí∞</button>
                    </div>
                </div>
            </div>

            <div id="skins-content" class="tab-content" style="display: none;">
                 <div class="section-title">üé≠ –°–∫–∏–Ω—ã (–ë–æ–Ω—É—Å –∫ –º–æ–Ω–µ—Ç–∞–º)</div>
                 <div class="items-grid" id="skins-grid">
                     </div>
            </div>
            
            <div id="prizes-content" class="tab-content" style="display: none;">
                <div class="section-title">üéÅ –û–±–º–µ–Ω –Ω–∞ –ü—Ä–æ–º–æ–∫–æ–¥—ã (–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞!)</div>
                <div class="items-grid" id="prizes-grid">
                    </div>
            </div>
        </div>
    </div>
    
    <div class="offline-overlay" id="offlineOverlay"></div>
    <div class="offline-modal" id="offlineModal">
        <h2>–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, –ö–ª—ç—à–µ—Ä!</h2>
        <p>–¢—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª:</p>
        <p style="color:var(--accent); font-size: 24px;" id="offlineTime">0 –º–∏–Ω—É—Ç</p>
        <p>–¢–≤–æ–π –ì–æ–±–ª–∏–Ω-–≤–æ—Ä –∑–∞—Ä–∞–±–æ—Ç–∞–ª:</p>
        <div class="earnings" id="offlineEarnings">0</div>
        <p>–ú–æ–Ω–µ—Ç</p>
        <button onclick="closeOfflineModal()">–ö—Ä—É—Ç–æ!</button>
    </div>

    <script>
        // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–≥—Ä—ã –∏ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–õ–æ–≥–∏–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞) ---
        const SAVE_KEY = 'clashClickerSave';
        const MAX_OFFLINE_TIME_SECONDS = 12 * 60 * 60; 
        
        let coins = 0;
        let tapPower = 1;
        let autoClickPower = 0;
        
        let maxEnergy = 1000;
        let currentEnergy = 1000;
        let recoveryRate = 10; 
        
        let clickCost = 50;
        let autoCost = 200;
        let energyLimitCost = 500;
        let recoveryCost = 750;
        
        let soundOn = true; 
        let rebirthCount = 0; 
        
        // --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–£–¢–ò –í SKINS ---
        const skins = [
            { id: 'chest', name: '–°—É–Ω–¥—É–∫', src: 'clash-clicker/public/chest.png', fallback: 'https://raw.githubusercontent.com/smlbiobot/cr-assets-png/master/assets/sc/ui/chest_super_magical.png', price: 0, owned: true, soundFile: '/public/chest.mp3', coinBonus: 0.05 },
            { id: 'mk', name: '–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å', src: 'clash-clicker/public/mk.png', fallback: 'https://raw.githubusercontent.com/smlbiobot/cr-assets-png/master/assets/sc/cards/mega-knight.png', price: 500, owned: false, soundFile: '/public/mk.mp3', coinBonus: 0.08 },
            { id: 'balloon', name: '–®–∞—Ä', src: 'clash-clicker/public/balloon.png', fallback: 'https://raw.githubusercontent.com/smlbiobot/cr-assets-png/master/assets/sc/cards/balloon.png', price: 1000, owned: false, soundFile: '/public/baloon.mp3', coinBonus: 0.11 },
            { id: 'king', name: '–ö–æ—Ä–æ–ª—å', src: 'clash-clicker/public/king.png', fallback: 'https://raw.githubusercontent.com/smlbiobot/cr-assets-png/master/assets/sc/emotes/king-thumbs-up.png', price: 2000, owned: false, soundFile: '/public/king.mp3', coinBonus: 0.13 },
            { id: 'emote', name:"–•–∏-—Ö–∏-—Ö–∏-—Ö–∞" ,scr:  'clash-clicker/public/emote.png', fallback: 'https://raw.githubusercontent.com/smlbiobot/cr-assets-png/master/assets/sc/emotes/king-laughing.png', price: 5000, owned: false, soundFile: '/public/emote.mp3', coinBonus: 0.15 }
        ];
        
        // --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–£–¢–ò –í PRIZES ---
        const prizes = [
            { cost: 500000, name: '500 –ö–†–ò–°–¢–ê–õ–õ–û–í', img: 'clash-clicker/public/ChatGPT Image 29 –Ω–æ—è–±. 2025 –≥., 21_53_51 ‚Äî –∫–æ–ø–∏—è.jpg', promo: '@reversoqss_CRYSTAL500' },
            { cost: 5000000, name: '1200 –ö–†–ò–°–¢–ê–õ–õ–û–í', img: 'clash-clicker/public/ChatGPT Image 29 –Ω–æ—è–±. 2025 –≥., 21_53_51 ‚Äî –∫–æ–ø–∏—è ‚Äî –∫–æ–ø–∏—è.jpg', promo: '@reversoqss_CRYSTAL1200' },
            { cost: 50000000, name: 'PASS ROYALE', img: 'clash-clicker/public/ChatGPT Image 29 –Ω–æ—è–±. 2025 –≥., 22_14_21.jpg', promo: '@reversoqss_PASSROYALE' },
            { cost: 55000000, name: '6x –≠–í–û –û–°–ö–û–õ–ö–ò', img: 'clash-clicker/public/Wild-Shard-clash-royale.png', promo: '@reversoqss_EVOSIX' },
            { cost: 5000000, name: '80 –ö–†–ò–°–¢–ê–õ–õ–û–í', img: 'clash-clicker/public/ChatGPT Image 29 –Ω–æ—è–±. 2025 –≥., 21_53_51.jpg', promo: '@reversoqss_CRYSTAL80' },
        ];


        // --- –≠–ª–µ–º–µ–Ω—Ç—ã (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) ---
        const scoreEl = document.getElementById('score');
        const tapPowerEl = document.getElementById('tap-power');
        const mainSkinEl = document.getElementById('mainSkin');
        const energyBarEl = document.getElementById('energy-bar');
        const energyTextEl = document.getElementById('energy-text');
        
        const btnClick = document.getElementById('btn-click');
        const btnAuto = document.getElementById('btn-auto');
        const btnELimit = document.getElementById('btn-energy-limit');
        const btnRecovery = document.getElementById('btn-recovery');
        const toggleSoundBtn = document.getElementById('toggle-sound');
        
        const offlineModalEl = document.getElementById('offlineModal');
        const offlineOverlayEl = document.getElementById('offlineOverlay');


        // --- –õ–æ–≥–∏–∫–∞ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ó–∞–≥—Ä—É–∑–∫–∏ –∏ –≠–Ω–µ—Ä–≥–∏–∏ (–ö–∞–∫ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º –∫–æ–¥–µ) ---

        function saveGame() {
            const gameState = {
                coins: coins,
                tapPower: tapPower,
                autoClickPower: autoClickPower,
                
                maxEnergy: maxEnergy,
                currentEnergy: currentEnergy, 
                recoveryRate: recoveryRate,
                soundOn: soundOn, 
                rebirthCount: rebirthCount, 

                clickCost: clickCost,
                autoCost: autoCost,
                energyLimitCost: energyLimitCost,
                recoveryCost: recoveryCost,
                
                skins: skins,
                
                lastSaveTime: Date.now() 
            };
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        }

        function loadGame() {
            const savedData = localStorage.getItem(SAVE_KEY);
            if (!savedData) return;

            const gameState = JSON.parse(savedData);
            
            coins = gameState.coins || 0;
            tapPower = gameState.tapPower || 1;
            autoClickPower = gameState.autoClickPower || 0;
            
            maxEnergy = gameState.maxEnergy || 1000;
            currentEnergy = gameState.currentEnergy || 1000;
            recoveryRate = gameState.recoveryRate || 10;
            soundOn = gameState.soundOn !== undefined ? gameState.soundOn : true; 
            rebirthCount = gameState.rebirthCount || 0; 

            clickCost = gameState.clickCost || 50;
            autoCost = gameState.autoCost || 200;
            energyLimitCost = gameState.energyLimitCost || 500;
            recoveryCost = gameState.recoveryCost || 750;
            
            if (gameState.skins) {
                gameState.skins.forEach(savedSkin => {
                    const currentSkin = skins.find(s => s.id === savedSkin.id);
                    if (currentSkin) {
                        currentSkin.owned = savedSkin.owned;
                    }
                });
            }
            
            if (gameState.lastSaveTime) {
                const timeSinceLastSaveMs = Date.now() - gameState.lastSaveTime;
                const timeSinceLastSaveSec = Math.floor(timeSinceLastSaveMs / 1000);
                
                const offlineTimeSec = Math.min(timeSinceLastSaveSec, MAX_OFFLINE_TIME_SECONDS);
                
                // 1. –û—Ñ—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–æ–∫ 
                if (autoClickPower > 0) {
                    const baseEarnings = offlineTimeSec * autoClickPower;
                    const earnings = Math.floor(baseEarnings * getTotalCoinBonus());
                    
                    if (earnings > 0) {
                        coins += earnings;
                        showOfflineModal(offlineTimeSec, earnings);
                    }
                }

                // 2. –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏
                const energyRecovered = (recoveryRate * offlineTimeSec);
                currentEnergy += energyRecovered;
            }
            
            currentEnergy = Math.min(currentEnergy, maxEnergy); 
            
            const currentSkin = skins.find(s => s.owned);
            if (currentSkin) {
                mainSkinEl.src = currentSkin.src;
                mainSkinEl.onerror = function() { this.src = currentSkin.fallback; };
            }
        }

        function getCurrentSkinBonus() {
            const activeSkin = skins.find(s => 
                mainSkinEl.src.includes(s.src) || (mainSkinEl.onerror && mainSkinEl.onerror.toString().includes(s.fallback))
            );
            return activeSkin ? activeSkin.coinBonus : 0; 
        }

        function getTotalCoinBonus() {
            const rebirthBonus = rebirthCount * 0.05; 
            const skinBonus = getCurrentSkinBonus();
            return 1 + rebirthBonus + skinBonus; 
        }

        function addCoins(baseAmount) {
            const multiplier = getTotalCoinBonus();
            const finalAmount = baseAmount * multiplier;
            coins += finalAmount;
        }

        function performRebirth() {
            rebirthCount++;

            coins = 0;
            tapPower = 1;
            autoClickPower = 0;
            maxEnergy = 1000;
            currentEnergy = 1000;
            recoveryRate = 10;
            clickCost = 50;
            autoCost = 200;
            energyLimitCost = 500;
            recoveryCost = 750;
            soundOn = true; 

            skins.forEach(s => {
                s.owned = (s.id === 'chest');
            });

            const defaultSkin = skins.find(s => s.id === 'chest');
            if (defaultSkin) {
                mainSkinEl.src = defaultSkin.src;
                mainSkinEl.onerror = function() { this.src = defaultSkin.fallback; };
            }
            
            if (autoClickPower > 0) {
                startAutoClicker();
            } else if (autoClickInterval) {
                clearInterval(autoClickInterval);
                autoClickInterval = null;
            }
            
            saveGame();
            updateUI();
            alert(`üéâ –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ï –£–°–ü–ï–®–ù–û! üéâ\n\n–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω.\n–¢–µ–∫—É—â–∏–π –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–æ–Ω—É—Å –∫ –º–æ–Ω–µ—Ç–∞–º –æ—Ç –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è: ${Math.round(rebirthCount * 5)}%.\n\n–ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —Å —É—Å–∏–ª–µ–Ω–∏—è–º–∏!`);
        }

        mainSkinEl.addEventListener('click', (e) => {
            const energyUsed = tapPower;
            
            if (currentEnergy >= energyUsed) {
                if (navigator.vibrate) navigator.vibrate(50);

                currentEnergy -= energyUsed;
                addCoins(tapPower); 
                
                const currentSkin = skins.find(s => 
                    mainSkinEl.src.includes(s.src) || (mainSkinEl.onerror && mainSkinEl.onerror.toString().includes(s.fallback))
                );
                if (currentSkin && currentSkin.soundFile) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é playSound
                    playSound(currentSkin.soundFile); 
                }
                
                const coinsEarned = Math.floor(tapPower * getTotalCoinBonus());
                createFloatingText(e.clientX, e.clientY, `+${coinsEarned}`);
                mainSkinEl.style.transform = "scale(0.9)";
                setTimeout(() => mainSkinEl.style.transform = "scale(1)", 80);
                
                saveGame(); 
            } else {
                createFloatingText(e.clientX, e.clientY, `–ù–µ—Ç ${energyUsed} —ç–Ω–µ—Ä–≥–∏–∏!`, true);
            }
            updateUI();
        });

        function toggleSound() {
            soundOn = !soundOn;
            toggleSoundBtn.innerText = soundOn ? 'üîä' : 'üîá';
            saveGame();
        }

        function playSound(fileName) {
            if (!soundOn) return; 
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ —Å –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ú –ü–£–¢–ï–ú
            const audio = new Audio(fileName);
            audio.volume = 0.5; 
            audio.play().catch(e => console.log(`Audio (${fileName}) play failed:`, e));
        }

        function showOfflineModal(timeSec, earnings) {
            const timeFormatted = formatTime(timeSec);
            document.getElementById('offlineTime').innerText = timeFormatted;
            document.getElementById('offlineEarnings').innerText = Math.floor(earnings).toLocaleString();
            offlineOverlayEl.classList.add('open');
            offlineModalEl.classList.add('open');
        }

        function closeOfflineModal() {
            offlineOverlayEl.classList.remove('open');
            offlineModalEl.classList.remove('open');
        }
        
        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            let result = '';
            if (hours > 0) result += `${hours} —á `;
            if (minutes > 0) result += `${minutes} –º–∏–Ω `;
            if (seconds > 0 || result === '') result += `${seconds} —Å–µ–∫`;
            
            return result.trim();
        }

        function updateUI() {
            toggleSoundBtn.innerText = soundOn ? 'üîä' : 'üîá';
            
            const currentRebirthBonus = rebirthCount * 5;
            const currentSkinBonus = Math.round(getCurrentSkinBonus() * 100);
            const totalBonusPercent = currentRebirthBonus + currentSkinBonus;
            
            const rebirthDisplay = document.getElementById('rebirth-status-display');
            rebirthDisplay.innerText = `üî• –ë–æ–Ω—É—Å: ${totalBonusPercent}% (–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ: ${currentRebirthBonus}%)`;
            rebirthDisplay.style.display = totalBonusPercent > 0 ? 'block' : 'none';
            
            scoreEl.innerText = Math.floor(coins).toLocaleString();
            tapPowerEl.innerText = tapPower;
            
            currentEnergy = Math.min(currentEnergy, maxEnergy);
            energyBarEl.value = currentEnergy;
            energyBarEl.max = maxEnergy;
            energyTextEl.innerText = `${Math.floor(currentEnergy)} / ${maxEnergy}`;
            
            if (currentEnergy < tapPower) { 
                mainSkinEl.classList.add('disabled');
            } else {
                mainSkinEl.classList.remove('disabled');
            }
            
            btnClick.innerText = `${clickCost.toLocaleString()} üí∞`;
            btnAuto.innerText = `${autoCost.toLocaleString()} üí∞/—Å–µ–∫`;
            btnELimit.innerText = `${energyLimitCost.toLocaleString()} üí∞`;
            btnRecovery.innerText = `${recoveryCost.toLocaleString()} üí∞`;
            
            btnClick.disabled = coins < clickCost;
            btnAuto.disabled = coins < autoCost;
            btnELimit.disabled = coins < energyLimitCost;
            btnRecovery.disabled = coins < recoveryCost;
            
            const activeTab = document.querySelector('.tab-btn.active');
            if (activeTab) {
                const tabId = activeTab.getAttribute('onclick').match(/'(.*?)'/)[1];
                if (tabId === 'skins') renderSkins();
                if (tabId === 'prizes') renderPrizes();
            }
        }

        function createFloatingText(x, y, text, isError = false) {
            const el = document.createElement('div');
            el.className = 'floating-text';
            if (isError) el.classList.add('error');
            el.innerText = text;
            
            const offsetX = (Math.random() - 0.5) * 40;
            el.style.left = `${x + offsetX}px`;
            el.style.top = `${y - 50}px`;
            
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

            const contentEl = document.getElementById(tabId + '-content');
            contentEl.style.display = 'block';
            
            document.querySelector(`.tab-btn[onclick*="${tabId}"]`).classList.add('active');

            if (tabId === 'skins') renderSkins();
            if (tabId === 'prizes') renderPrizes(); 
            if (tabId === 'upgrades') {
                 contentEl.style.display = 'grid'; 
            }
            updateUI();
        }

        function toggleShop() {
            const modal = document.getElementById('shopModal');
            const overlay = document.getElementById('modalOverlay');
            modal.classList.toggle('open');
            overlay.classList.toggle('open');
            if (modal.classList.contains('open')) {
                showTab('upgrades'); 
            }
            updateUI();
        }

        function buyUpgrade(type) {
            let cost = 0;
            if (type === 'click') {
                cost = clickCost;
                if (coins >= cost) {
                    coins -= cost;
                    tapPower++;
                    clickCost = Math.floor(clickCost * 1.6);
                }
            } else if (type === 'auto') {
                cost = autoCost;
                if (coins >= cost) {
                    coins -= cost;
                    autoClickPower++;
                    autoCost = Math.floor(autoCost * 1.5);
                    startAutoClicker();
                }
            } else if (type === 'energy_limit') {
                cost = energyLimitCost;
                if (coins >= cost) {
                    coins -= cost;
                    maxEnergy += 500;
                    currentEnergy += 500; 
                    energyLimitCost = Math.floor(energyLimitCost * 1.8);
                }
            } else if (type === 'recovery') {
                cost = recoveryCost;
                if (coins >= cost) {
                    coins -= cost;
                    recoveryRate += 1; 
                    recoveryCost = Math.floor(recoveryCost * 1.7);
                }
            }
            
            saveGame();
            updateUI();
        }
        
        function renderSkins() {
            const container = document.getElementById('skins-grid');
            container.innerHTML = '';
            skins.forEach(skin => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `shop-item ${skin.owned ? 'owned' : ''}`;
                let btnHTML = '';
                
                const isActive = mainSkinEl.src.includes(skin.src) || (mainSkinEl.onerror && mainSkinEl.onerror.toString().includes(skin.fallback));
                const bonusPercent = Math.round(skin.coinBonus * 100);
                
                if (skin.owned) {
                    btnHTML = `<button onclick="selectSkin('${skin.id}')" style="background:${isActive ? '#1abc9c' : '#2ecc71'}; color:#fff; border-color:#27ae60;">${isActive ? '–ù–∞–¥–µ—Ç–æ' : '–ù–∞–¥–µ—Ç—å'}</button>`;
                } else {
                    const disabled = coins < skin.price ? 'disabled' : '';
                    btnHTML = `<button onclick="buySkin('${skin.id}')" ${disabled}>${skin.price.toLocaleString()} üí∞</button>`;
                }
                itemDiv.innerHTML = `
                    <div class="owned-badge">‚úì</div>
                    <img src="${skin.src}" onerror="this.src='${skin.fallback}'" alt="${skin.name}">
                    <h3>${skin.name}</h3>
                    <p style="color:#f7b42c;">–ë–æ–Ω—É—Å: +${bonusPercent}%</p>
                    ${btnHTML}
                `;
                container.appendChild(itemDiv);
            });
        }
        function buySkin(id) {
            const skin = skins.find(s => s.id === id);
            if (skin && !skin.owned && coins >= skin.price) {
                coins -= skin.price;
                skin.owned = true;
                saveGame();
                updateUI();
            }
        }
        function selectSkin(id) {
            const skin = skins.find(s => s.id === id);
            if (skin && skin.owned) {
                mainSkinEl.src = skin.src;
                mainSkinEl.onerror = function() { this.src = skin.fallback; };
                saveGame();
                updateUI();
            }
        }
        
        function renderPrizes() {
            const container = document.getElementById('prizes-grid');
            container.innerHTML = '';
            prizes.forEach((prize, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                const disabled = coins < prize.cost ? 'disabled' : '';
                
                itemDiv.innerHTML = `
                    <img src="${prize.img}" alt="${prize.name}">
                    <h3>${prize.name}</h3>
                    <p>–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</p>
                    <button onclick="withdrawPrize(${index})" ${disabled}>${prize.cost.toLocaleString()} üí∞</button>
                `;
                container.appendChild(itemDiv);
            });
        }
        
        function withdrawPrize(index) {
            const prize = prizes[index];
            if (coins >= prize.cost) {
                
                const proceed = confirm(
                    `–í–ù–ò–ú–ê–ù–ò–ï! –í—ã–≤–æ–¥ –ø—Ä–∏–∑–∞ "${prize.name}" (—Å—Ç–æ–∏–º–æ—Å—Ç—å ${prize.cost.toLocaleString()} üí∞) –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–Æ.\n\n–í–ï–°–¨ –í–ê–® –ü–†–û–ì–†–ï–°–° (–º–æ–Ω–µ—Ç—ã, —É–ª—É—á—à–µ–Ω–∏—è, —Å–∫–∏–Ω—ã) –ë–£–î–ï–¢ –°–ë–†–û–®–ï–ù, –Ω–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–æ–Ω—É—Å +5% –∫ –∑–∞—Ä–∞–±–æ—Ç–∫—É.\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`
                );

                if (proceed) {
                    
                    alert(`üéÅ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! üéÅ\n\n–í—ã –æ–±–º–µ–Ω—è–ª–∏ –º–æ–Ω–µ—Ç—ã –Ω–∞ –ø—Ä–∏–∑ "${prize.name}".\n\n–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥:\n${prize.promo}\n\n–¢–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ.`);
                    
                    performRebirth();
                }
            }
        }


        // --- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã (–õ–æ–≥–∏–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞) ---
        
        let autoClickInterval;
        let energyRecoveryInterval;

        function startAutoClicker() {
            if (autoClickInterval) clearInterval(autoClickInterval);
            
            autoClickInterval = setInterval(() => {
                if (autoClickPower > 0) {
                    addCoins(autoClickPower); 
                }
                saveGame(); 
                updateUI();
            }, 1000); 
        }
        
        function recoverEnergy() {
            if (currentEnergy < maxEnergy) {
                currentEnergy += recoveryRate / 10; 
                currentEnergy = Math.min(currentEnergy, maxEnergy);
            }
            updateUI();
        }
        
        function startEnergyRecovery() {
            if (energyRecoveryInterval) clearInterval(energyRecoveryInterval);
            energyRecoveryInterval = setInterval(recoverEnergy, 100); 
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ò–≥—Ä—ã ---

        loadGame();
        startEnergyRecovery();
        
        if (autoClickPower > 0) {
            startAutoClicker();
        }
        updateUI();
        
        window.onbeforeunload = saveGame;

    </script>
</body>

</html>

